(function() {
  'use strict';

  angular
    .module('gpquery.core')
    .factory('Flag', FlagFactory);

  /**
   * Flag Service
   *
   * @description
   * Retrieves the ISO-3166 alpha-2 code given a country or demonym for use with flag icons
   *
   * @link http://ergast.com/mrd/methods/drivers/
   * @link https://docs.angularjs.org/api/ngResource/service/$resource
   * @link https://docs.angularjs.org/api/ng/service/$http
   */
  /** @ngInject */
  function FlagFactory(_) {

    /**
     * @todo Speed test comparison between:
     *  1. single array of objects to search by values (current)
     *  2. two arrays of maps where `key: value` corresponds to `country: iso2` and `demonym: iso2`
     */
    var data = [{country: 'Afghanistan', demonym: 'Afghan', iso2: 'af'}, {country: 'Albania', demonym: 'Albanian', iso2: 'al'}, {country: 'Antarctica', demonym: 'Antartican', iso2: 'aq'}, {country: 'Algeria', demonym: 'Algerian', iso2: 'dz'}, {country: 'American Samoa', demonym: 'Samoan', iso2: 'as'}, {country: 'Andorra', demonym: 'Andorran', iso2: 'ad'}, {country: 'Angola', demonym: 'Angolan', iso2: 'ao'}, {country: 'Antigua and Barbuda', demonym: 'Antiguan and Barbudan', iso2: 'ag'}, {country: 'Azerbaijan', demonym: 'Azerbaijani', iso2: 'az'}, {country: 'Argentina', demonym: 'Argentine', iso2: 'ar'}, {country: 'Australia', demonym: 'Australian', iso2: 'au'}, {country: 'Austria', demonym: 'Austrian', iso2: 'at'}, {country: 'Bahamas', demonym: 'Bahamian', iso2: 'bs'}, {country: 'Bahrain', demonym: 'Bahraini', iso2: 'bh'}, {country: 'Bangladesh', demonym: 'Bangladeshi', iso2: 'bd'}, {country: 'Armenia', demonym: 'Armenian', iso2: 'am'}, {country: 'Barbados', demonym: 'Barbadian', iso2: 'bb'}, {country: 'Belgium', demonym: 'Belgian', iso2: 'be'}, {country: 'Bermuda', demonym: 'Bermudian', iso2: 'bm'}, {country: 'Bhutan', demonym: 'Bhutanese', iso2: 'bt'}, {country: 'Bolivia', demonym: 'Bolivian', iso2: 'bo'}, {country: 'Bosnia and Herzegovina', demonym: 'Bosnian', iso2: 'ba'}, {country: 'Botswana', demonym: 'Botswanan', iso2: 'bw'}, {country: 'Bouvet Island', demonym: 'of Bouvet island', iso2: 'bv'}, {country: 'Brazil', demonym: 'Brazilian', iso2: 'br'}, {country: 'Belize', demonym: 'Belizean', iso2: 'bz'}, {country: 'British Indian Ocean Territory', demonym: 'Changosian', iso2: 'io'}, {country: 'Solomon Islands', demonym: 'Solomon Islander', iso2: 'sb'}, {country: 'Virgin Islands (British)', demonym: 'British Virgin Islander', iso2: 'vg'}, {country: 'Brunei Darussalam', demonym: 'Bruneian', iso2: 'bn'}, {country: 'Bulgaria', demonym: 'Bulgarian', iso2: 'bg'}, {country: 'Myanmar', demonym: 'Burmese', iso2: 'mm'}, {country: 'Burundi', demonym: 'Burundian', iso2: 'bi'}, {country: 'Belarus', demonym: 'Belarusian', iso2: 'by'}, {country: 'Cambodia', demonym: 'Cambodian', iso2: 'kh'}, {country: 'Cameroon', demonym: 'Cameroonian', iso2: 'cm'}, {country: 'Canada', demonym: 'Canadian', iso2: 'ca'}, {country: 'Cape Verde', demonym: 'Cape Verdean', iso2: 'cv'}, {country: 'Cayman Islands', demonym: 'Caymanian', iso2: 'ky'}, {country: 'Central African Republic', demonym: 'Central African', iso2: 'cf'}, {country: 'Sri Lanka', demonym: 'Sri Lankan', iso2: 'lk'}, {country: 'Chad', demonym: 'Chadian', iso2: 'td'}, {country: 'Chile', demonym: 'Chilean', iso2: 'cl'}, {country: 'China', demonym: 'Chinese', iso2: 'cn'}, {country: 'Taiwan', demonym: 'Taiwanese', iso2: 'tw'}, {country: 'Christmas Island', demonym: 'Christmas Islander', iso2: 'cx'}, {country: 'Cocos Islands', demonym: 'Cocos Islander', iso2: 'cc'}, {country: 'Colombia', demonym: 'Colombian', iso2: 'co'}, {country: 'Comoros', demonym: 'Comorian', iso2: 'km'}, {country: 'Mayotte', demonym: 'Mahorais', iso2: 'yt'}, {country: 'Congo', demonym: 'Congolese', iso2: 'cg'}, {country: 'Congo, the Democratic Republic of the', demonym: 'Congolese', iso2: 'cd'}, {country: 'Cook Islands', demonym: 'Cook Islander', iso2: 'ck'}, {country: 'Costa Rica', demonym: 'Costa Rican', iso2: 'cr'}, {country: 'Croatia', demonym: 'Croatian', iso2: 'hr'}, {country: 'Cuba', demonym: 'Cuban', iso2: 'cu'}, {country: 'Cyprus', demonym: 'Cypriot', iso2: 'cy'}, {country: 'Czech Republic', demonym: 'Czech', iso2: 'cz'}, {country: 'Benin', demonym: 'Beninese', iso2: 'bj'}, {country: 'Denmark', demonym: 'Danish', iso2: 'dk'}, {country: 'Dominica', demonym: 'Dominican', iso2: 'dm'}, {country: 'Dominican Republic', demonym: 'Dominican', iso2: 'do'}, {country: 'Ecuador', demonym: 'Ecuadorian', iso2: 'ec'}, {country: 'El Salvador', demonym: 'Salvadoran', iso2: 'sv'}, {country: 'Equatorial Guinea', demonym: 'Equatorial Guinean', iso2: 'gq'}, {country: 'Ethiopia', demonym: 'Ethiopian', iso2: 'et'}, {country: 'Eritrea', demonym: 'Eritrean', iso2: 'er'}, {country: 'Estonia', demonym: 'Estonian', iso2: 'ee'}, {country: 'Faroe Islands', demonym: 'Faeroese', iso2: 'fo'}, {country: 'Falkland Islands', demonym: 'Falkland Islander', iso2: 'fk'}, {country: 'South Georgia and the South Sandwich Islands', demonym: 'of South Georgia and the South Sandwich Islands', iso2: 'gs'}, {country: 'Fiji', demonym: 'Fijian', iso2: 'fj'}, {country: 'Finland', demonym: 'Finnish', iso2: 'fi'}, {country: 'Åland Islands', demonym: 'Åland Islander', iso2: 'ax'}, {country: 'France', demonym: 'French', iso2: 'fr'}, {country: 'French Guiana', demonym: 'Guianese', iso2: 'gf'}, {country: 'French Polynesia', demonym: 'Polynesian', iso2: 'pf'}, {country: 'French Southern Territories', demonym: 'of French Southern and Antarctic Lands', iso2: 'tf'}, {country: 'Djibouti', demonym: 'Djiboutian', iso2: 'dj'}, {country: 'Gabon', demonym: 'Gabonese', iso2: 'ga'}, {country: 'Georgia', demonym: 'Georgian', iso2: 'ge'}, {country: 'Gambia', demonym: 'Gambian', iso2: 'gm'}, {country: 'East Germany', demonym: 'East German', iso2: 'dd'}, {country: 'Germany', demonym: 'German', iso2: 'de'}, {country: 'Ghana', demonym: 'Ghanaian', iso2: 'gh'}, {country: 'Gibraltar', demonym: 'Gibraltarian', iso2: 'gi'}, {country: 'Kiribati', demonym: 'Kiribatian', iso2: 'ki'}, {country: 'Greece', demonym: 'Greek', iso2: 'gr'}, {country: 'Greenland', demonym: 'Greenlander', iso2: 'gl'}, {country: 'Grenada', demonym: 'Grenadian', iso2: 'gd'}, {country: 'Guadeloupe', demonym: 'Guadeloupean', iso2: 'gp'}, {country: 'Guam', demonym: 'Guamanian', iso2: 'gu'}, {country: 'Guatemala', demonym: 'Guatemalan', iso2: 'gt'}, {country: 'Guinea', demonym: 'Guinean', iso2: 'gn'}, {country: 'Guyana', demonym: 'Guyanese', iso2: 'gy'}, {country: 'Haiti', demonym: 'Haitian', iso2: 'ht'}, {country: 'Heard Island and McDonald Islands', demonym: 'of Territory of Heard Island and McDonald Islands', iso2: 'hm'}, {country: 'Holy See', demonym: 'of the Vatican', iso2: 'va'}, {country: 'Honduras', demonym: 'Honduran', iso2: 'hn'}, {country: 'Hong Kong', demonym: 'Hong Kong Chinese', iso2: 'hk'}, {country: 'Hungary', demonym: 'Hungarian', iso2: 'hu'}, {country: 'Iceland', demonym: 'Icelander', iso2: 'is'}, {country: 'India', demonym: 'Indian', iso2: 'in'}, {country: 'Indonesia', demonym: 'Indonesian', iso2: 'id'}, {country: 'Iran', demonym: 'Iranian', iso2: 'ir'}, {country: 'Iraq', demonym: 'Iraqi', iso2: 'iq'}, {country: 'Ireland', demonym: 'Irish', iso2: 'ie'}, {country: 'Israel', demonym: 'Israeli', iso2: 'il'}, {country: 'Italy', demonym: 'Italian', iso2: 'it'}, {country: 'Ivory Coast', demonym: 'Ivorian', iso2: 'ci'}, {country: 'Jamaica', demonym: 'Jamaican', iso2: 'jm'}, {country: 'Japan', demonym: 'Japanese', iso2: 'jp'}, {country: 'Kazakhstan', demonym: 'Kazakh', iso2: 'kz'}, {country: 'Jordan', demonym: 'Jordanian', iso2: 'jo'}, {country: 'Kenya', demonym: 'Kenyan', iso2: 'ke'}, {country: 'North Korea', demonym: 'North Korean', iso2: 'kp'}, {country: 'South Korea', demonym: 'South Korean', iso2: 'kr'}, {country: 'Korea', demonym: 'Korean', iso2: 'kr'}, {country: 'Kuwait', demonym: 'Kuwaiti', iso2: 'kw'}, {country: 'Kyrgyzstan', demonym: 'Kyrgyz', iso2: 'kg'}, {country: 'Lao', demonym: 'Lao', iso2: 'la'}, {country: 'Lebanon', demonym: 'Lebanese', iso2: 'lb'}, {country: 'Lesotho', demonym: 'Basotho', iso2: 'ls'}, {country: 'Latvia', demonym: 'Latvian', iso2: 'lv'}, {country: 'Liberia', demonym: 'Liberian', iso2: 'lr'}, {country: 'Libya', demonym: 'Libyan', iso2: 'ly'}, {country: 'Liechtenstein', demonym: 'Liechtensteiner', iso2: 'li'}, {country: 'Lithuania', demonym: 'Lithuanian', iso2: 'lt'}, {country: 'Luxembourg', demonym: 'Luxembourger', iso2: 'lu'}, {country: 'Macao', demonym: 'Macanese', iso2: 'mo'}, {country: 'Madagascar', demonym: 'Malagasy', iso2: 'mg'}, {country: 'Malawi', demonym: 'Malawian', iso2: 'mw'}, {country: 'Malaysia', demonym: 'Malaysian', iso2: 'my'}, {country: 'Maldives', demonym: 'Maldivian', iso2: 'mv'}, {country: 'Mali', demonym: 'Malian', iso2: 'ml'}, {country: 'Malta', demonym: 'Maltese', iso2: 'mt'}, {country: 'Martinique', demonym: 'Martinican', iso2: 'mq'}, {country: 'Mauritania', demonym: 'Mauritanian', iso2: 'mr'}, {country: 'Mauritius', demonym: 'Mauritian', iso2: 'mu'}, {country: 'Mexico', demonym: 'Mexican', iso2: 'mx'}, {country: 'Monaco', demonym: 'Monegasque', iso2: 'mc'}, {country: 'Mongolia', demonym: 'Mongolian', iso2: 'mn'}, {country: 'Moldova', demonym: 'Moldovan', iso2: 'md'}, {country: 'Montenegro', demonym: 'Montenegrin', iso2: 'me'}, {country: 'Montserrat', demonym: 'Montserratian', iso2: 'ms'}, {country: 'Morocco', demonym: 'Moroccan', iso2: 'ma'}, {country: 'Mozambique', demonym: 'Mozambican', iso2: 'mz'}, {country: 'Oman', demonym: 'Omani', iso2: 'om'}, {country: 'Namibia', demonym: 'Namibian', iso2: 'na'}, {country: 'Nauru', demonym: 'Nauruan', iso2: 'nr'}, {country: 'Nepal', demonym: 'Nepalese', iso2: 'np'}, {country: 'Netherlands', demonym: 'Dutch', iso2: 'nl'}, {country: 'Curaçao', demonym: 'Curaçaoan', iso2: 'cw'}, {country: 'Aruba', demonym: 'Aruban', iso2: 'aw'}, {country: 'Sint Maarten', demonym: 'Sint Maartener', iso2: 'sx'}, {country: 'Bonaire, Sint Eustatius and Saba', demonym: 'of Bonaire, Sint Eustatius and Saba', iso2: 'bq'}, {country: 'New Caledonia', demonym: 'New Caledonian', iso2: 'nc'}, {country: 'Vanuatu', demonym: 'Vanuatuan', iso2: 'vu'}, {country: 'New Zealand', demonym: 'New Zealander', iso2: 'nz'}, {country: 'Nicaragua', demonym: 'Nicaraguan', iso2: 'ni'}, {country: 'Niger', demonym: 'Nigerien', iso2: 'ne'}, {country: 'Nigeria', demonym: 'Nigerian', iso2: 'ng'}, {country: 'Niue', demonym: 'Niuean', iso2: 'nu'}, {country: 'Norfolk Island', demonym: 'Norfolk Islander', iso2: 'nf'}, {country: 'Norway', demonym: 'Norwegian', iso2: 'no'}, {country: 'Northern Mariana Islands', demonym: 'Northern Mariana Islander', iso2: 'mp'}, {country: 'United States Minor Outlying Islands', demonym: 'of United States Minor Outlying Islands', iso2: 'um'}, {country: 'Micronesia', demonym: 'Micronesian', iso2: 'fm'}, {country: 'Marshall Islands', demonym: 'Marshallese', iso2: 'mh'}, {country: 'Palau', demonym: 'Palauan', iso2: 'pw'}, {country: 'Pakistan', demonym: 'Pakistani', iso2: 'pk'}, {country: 'Panama', demonym: 'Panamanian', iso2: 'pa'}, {country: 'Papua New Guinea', demonym: 'Papua New Guinean', iso2: 'pg'}, {country: 'Paraguay', demonym: 'Paraguayan', iso2: 'py'}, {country: 'Peru', demonym: 'Peruvian', iso2: 'pe'}, {country: 'Philippines', demonym: 'Filipino', iso2: 'ph'}, {country: 'Pitcairn', demonym: 'Pitcairner', iso2: 'pn'}, {country: 'Poland', demonym: 'Polish', iso2: 'pl'}, {country: 'Portugal', demonym: 'Portuguese', iso2: 'pt'}, {country: 'Guinea-Bissau', demonym: 'Guinea-Bissau national', iso2: 'gw'}, {country: 'Timor-Leste', demonym: 'East Timorese', iso2: 'tl'}, {country: 'Puerto Rico', demonym: 'Puerto Rican', iso2: 'pr'}, {country: 'Qatar', demonym: 'Qatari', iso2: 'qa'}, {country: 'Réunion', demonym: 'Reunionese', iso2: 're'}, {country: 'Romania', demonym: 'Romanian', iso2: 'ro'}, {country: 'Russia', demonym: 'Russian', iso2: 'ru'}, {country: 'Rwanda', demonym: 'Rwandan', iso2: 'rw'}, {country: 'Saint Barthélemy', demonym: 'of Saint Barthélemy', iso2: 'bl'}, {country: 'Saint Helena', demonym: 'Saint Helenian', iso2: 'sh'}, {country: 'Saint Kitts and Nevis', demonym: 'Kittsian and Nevisian', iso2: 'kn'}, {country: 'Anguilla', demonym: 'Anguillan', iso2: 'ai'}, {country: 'Saint Lucia', demonym: 'Saint Lucian', iso2: 'lc'}, {country: 'Saint Martin', demonym: 'of Saint Martin', iso2: 'mf'}, {country: 'Saint Pierre and Miquelon', demonym: 'St-Pierrais and Miquelonnais', iso2: 'pm'}, {country: 'Saint Vincent and the Grenadines', demonym: 'Vincentian', iso2: 'vc'}, {country: 'San Marino', demonym: 'San Marinese', iso2: 'sm'}, {country: 'Sao Tome and Principe', demonym: 'São Toméan', iso2: 'st'}, {country: 'Saudi Arabia', demonym: 'Saudi Arabian', iso2: 'sa'}, {country: 'Senegal', demonym: 'Senegalese', iso2: 'sn'}, {country: 'Serbia', demonym: 'Serb', iso2: 'rs'}, {country: 'Seychelles', demonym: 'Seychellois', iso2: 'sc'}, {country: 'Sierra Leone', demonym: 'Sierra Leonean', iso2: 'sl'}, {country: 'Singapore', demonym: 'Singaporean', iso2: 'sg'}, {country: 'Slovakia', demonym: 'Slovak', iso2: 'sk'}, {country: 'Vietnam', demonym: 'Vietnamese', iso2: 'vn'}, {country: 'Slovenia', demonym: 'Slovene', iso2: 'si'}, {country: 'Somalia', demonym: 'Somali', iso2: 'so'}, {country: 'South Africa', demonym: 'South African', iso2: 'za'}, {country: 'Zimbabwe', demonym: 'Zimbabwean', iso2: 'zw'}, {country: 'Spain', demonym: 'Spanish', iso2: 'es'}, {country: 'South Sudan', demonym: 'South Sudanese', iso2: 'ss'}, {country: 'Sudan', demonym: 'Sudanese', iso2: 'sd'}, {country: 'Western Sahara', demonym: 'Sahrawi', iso2: 'eh'}, {country: 'Suriname', demonym: 'Surinamese', iso2: 'sr'}, {country: 'Svalbard and Jan Mayen', demonym: 'of Svalbard', iso2: 'sj'}, {country: 'Swaziland', demonym: 'Swazi', iso2: 'sz'}, {country: 'Sweden', demonym: 'Swedish', iso2: 'se'}, {country: 'Switzerland', demonym: 'Swiss', iso2: 'ch'}, {country: 'Syrian Arab Republic', demonym: 'Syrian', iso2: 'sy'}, {country: 'Tajikistan', demonym: 'Tajik', iso2: 'tj'}, {country: 'Thailand', demonym: 'Thai', iso2: 'th'}, {country: 'Togo', demonym: 'Togolese', iso2: 'tg'}, {country: 'Tokelau', demonym: 'Tokelauan', iso2: 'tk'}, {country: 'Tonga', demonym: 'Tongan', iso2: 'to'}, {country: 'Trinidad and Tobago', demonym: 'Trinidadian', iso2: 'tt'}, {country: 'United Arab Emirates', demonym: 'Emirian', iso2: 'ae'}, {country: 'UAE', demonym: 'Emirian', iso2: 'ae'}, {country: 'Abu Dhabi', demonym: 'Abu Dhabi', iso2: 'ae'}, {country: 'Tunisia', demonym: 'Tunisian', iso2: 'tn'}, {country: 'Turkey', demonym: 'Turk', iso2: 'tr'}, {country: 'Turkmenistan', demonym: 'Turkmen', iso2: 'tm'}, {country: 'Turks and Caicos Islands', demonym: 'Turks and Caicos Islander', iso2: 'tc'}, {country: 'Tuvalu', demonym: 'Tuvaluan', iso2: 'tv'}, {country: 'Uganda', demonym: 'Ugandan', iso2: 'ug'}, {country: 'Ukraine', demonym: 'Ukrainian', iso2: 'ua'}, {country: 'Macedonia', demonym: 'Macedonian', iso2: 'mk'}, {country: 'Egypt', demonym: 'Egyptian', iso2: 'eg'}, {country: 'United Kingdom', demonym: 'British', iso2: 'gb'}, {country: 'Great Britain', demonym: 'British', iso2: 'gb'}, {country: 'Britain', demonym: 'British', iso2: 'gb'}, {country: 'UK', demonym: 'British', iso2: 'gb'}, {country: 'Guernsey', demonym: 'of Guernsey', iso2: 'gg'}, {country: 'Jersey', demonym: 'of Jersey', iso2: 'je'}, {country: 'Isle of Man', demonym: 'Manxman', iso2: 'im'}, {country: 'Tanzania', demonym: 'Tanzanian', iso2: 'tz'}, {country: 'United States', demonym: 'American', iso2: 'us'}, {country: 'United States of America', demonym: 'American', iso2: 'us'}, {country: 'US', demonym: 'American', iso2: 'us'}, {country: 'USA', demonym: 'American', iso2: 'us'}, {country: 'Virgin Islands', demonym: 'Virgin Islander', iso2: 'vi'}, {country: 'Burkina Faso', demonym: 'Burkinabe', iso2: 'bf'}, {country: 'Uruguay', demonym: 'Uruguayan', iso2: 'uy'}, {country: 'Uzbekistan', demonym: 'Uzbek', iso2: 'uz'}, {country: 'Venezuela', demonym: 'Venezuelan', iso2: 've'}, {country: 'Wallis and Futuna', demonym: 'Wallisian', iso2: 'wf'}, {country: 'Samoa', demonym: 'Samoan', iso2: 'ws'}, {country: 'Yemen', demonym: 'Yemenite', iso2: 'ye'}, {country: 'Zambia', demonym: 'Zambian', iso2: 'zm'}, {country: 'Rhodesia', demonym: 'Rhodesian', iso2: 'rh'}, {country: 'European Union', demonym: 'European', iso2: 'eu'}, {country: 'Pacific', demonym: 'Pacific', iso2: 'jp'}];

    var service = {
      getByCountry: getByCountry,
      getByDemonym: getByDemonym,
      getByRaceName: getByRaceName
    };

    return service;

    function getByCountry(country) {
      return _.find(data, {country: _.deburr(country)}).iso2;
    }

    function getByDemonym(demonym) {
      return _.find(data, {demonym: _.deburr(demonym)}).iso2;
    }

    function getByRaceName(race) {

      var raceName = race.toLowerCase();

      if (_.endsWith(raceName, 'grand prix')) {
        raceName.slice(0, -11)
      } else if (_.endsWith(raceName, 'gp')) {
        raceName.slice(0, -2)
      }

      if (raceName == 'pacific') {
        raceName == 'japanese';
      } else if (raceName == 'european') {
        return 'eu';
      } else {
        return getByDemonym(raceName);
      }
    }

  }

})();
